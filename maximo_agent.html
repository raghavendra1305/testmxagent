<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maximo API Agent</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 960px; }
        .card { margin-bottom: 1.5rem; }
        .card-header { font-weight: bold; }
        #results-container {
            background-color: #212529;
            color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.375rem;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 500px;
            overflow-y: auto;
        }
        .spinner-border {
            width: 1.5rem;
            height: 1.5rem;
            vertical-align: text-bottom;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Maximo API Agent</h1>
            <a href="/" class="btn btn-outline-secondary">Back to Home</a>
        </div>

        <!-- Results Display -->
        <div class="card">
            <div class="card-header">API Response</div>
            <div class="card-body">
                <pre id="results-container">Awaiting your command...</pre>
            </div>
        </div>

        <!-- Test Connection -->
        <div class="card">
            <div class="card-header">1. Test Connection</div>
            <div class="card-body">
                <p class="card-text">Verify that the agent can connect to the Maximo server and authenticate with the configured API key.</p>
                <button id="test-conn-btn" class="btn btn-primary">Test Connection</button>
            </div>
        </div>

        <!-- Get Asset -->
        <div class="card">
            <div class="card-header">2. Get Asset Details</div>
            <div class="card-body">
                <form id="get-asset-form">
                    <div class="mb-3">
                        <label for="get-assetnum" class="form-label">Asset Number (Required)</label>
                        <input type="text" class="form-control" id="get-assetnum" required>
                    </div>
                    <div class="mb-3">
                        <label for="get-siteid" class="form-label">Site ID (Optional)</label>
                        <input type="text" class="form-control" id="get-siteid">
                    </div>
                    <button type="submit" class="btn btn-primary">Get Asset</button>
                </form>
            </div>
        </div>

        <!-- Update Asset Status -->
        <div class="card">
            <div class="card-header">3. Update Asset Status</div>
            <div class="card-body">
                <form id="update-status-form">
                    <div class="mb-3">
                        <label for="update-assetnum" class="form-label">Asset Number (Required)</label>
                        <input type="text" class="form-control" id="update-assetnum" required>
                    </div>
                    <div class="mb-3">
                        <label for="update-status" class="form-label">New Status (Required)</label>
                        <input type="text" class="form-control" id="update-status" required>
                    </div>
                    <div class="mb-3">
                        <label for="update-siteid" class="form-label">Site ID (Optional)</label>
                        <input type="text" class="form-control" id="update-siteid">
                    </div>
                    <button type="submit" class="btn btn-primary">Update Status</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const resultsContainer = document.getElementById('results-container');

        function showLoading(button) {
            button.disabled = true;
            button.innerHTML = `
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                Loading...
            `;
        }

        function hideLoading(button, originalText) {
            button.disabled = false;
            button.innerHTML = originalText;
        }

        function displayResult(data) {
            resultsContainer.textContent = JSON.stringify(data, null, 2);
        }

        // Test Connection
        document.getElementById('test-conn-btn').addEventListener('click', async (e) => {
            const button = e.target;
            const originalText = button.innerHTML;
            showLoading(button);
            resultsContainer.textContent = 'Testing connection...';
            try {
                const response = await fetch('/maximo/test_connection', { method: 'POST' });
                const data = await response.json();
                displayResult(data);
            } catch (error) {
                displayResult({ status: 'error', message: 'Client-side error: ' + error.message });
            } finally {
                hideLoading(button, originalText);
            }
        });

        // Get Asset
        document.getElementById('get-asset-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.innerHTML;
            showLoading(button);
            
            const assetnum = document.getElementById('get-assetnum').value;
            const siteid = document.getElementById('get-siteid').value;
            resultsContainer.textContent = `Fetching asset ${assetnum}...`;

            try {
                const response = await fetch('/maximo/get_asset', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ assetnum, siteid })
                });
                const data = await response.json();
                displayResult(data);
            } catch (error) {
                displayResult({ status: 'error', message: 'Client-side error: ' + error.message });
            } finally {
                hideLoading(button, originalText);
            }
        });

        // Update Asset Status
        document.getElementById('update-status-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.innerHTML;
            showLoading(button);

            const assetnum = document.getElementById('update-assetnum').value;
            const status = document.getElementById('update-status').value;
            const siteid = document.getElementById('update-siteid').value;
            resultsContainer.textContent = `Updating asset ${assetnum} to status ${status}...`;

            try {
                const response = await fetch('/maximo/update_asset_status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ assetnum, status, siteid })
                });
                const data = await response.json();
                displayResult(data);
            } catch (error) {
                displayResult({ status: 'error', message: 'Client-side error: ' + error.message });
            } finally {
                hideLoading(button, originalText);
            }
        });
    </script>
</body>
</html>